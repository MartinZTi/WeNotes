# 调用豆瓣API获取电影详情数据并展示
![](_v_images/20200602225052307_4243.png =300x)

![](_v_images/20200602225121009_6484.png =400x)
***
![](_v_images/20200602225159962_15212.png =500x)

![](_v_images/20200602225321887_23590.png =600x)
restful的形式

![](_v_images/20200602225353026_14500.png =600x)

![](_v_images/20200602225717743_11287.png =500x)
即：
![](_v_images/20200602225743768_10287.png =500x)
![](_v_images/20200602225902756_7429.png =500x)
![](_v_images/20200602225918363_32212.png =200x)

![](_v_images/20200602230204651_14604.png =600x)
![](_v_images/20200602230301043_22157.png =500x)

由于小程序开发中无法设置请求格式以符合 豆瓣API的要求（豆瓣API已经禁止小程序访问）

这时，可以通过 `中间服务器` 对`refere`这个header进行设置
:::alert-info
**Nginx** 转发代理  来 实现
(将小程序header中的固定格式Refere 给抹掉)

![](_v_images/20200602230856945_20000.png =700x)
:::

不直接发送给 豆瓣API ，而是先转给Nginx服务器，
![](_v_images/20200602231138358_16915.png =500x)
![](_v_images/20200602231154945_13665.png =500x)
**400解决办法： **
对request的HTTP请求的content-Type进行设置

![](_v_images/20200602231404082_4212.png =400x)
![](_v_images/20200602231904834_18511.png =500x)

**` data `** = 请求豆瓣API返回电影信息的json对象文本转化而来的js对象

可以将这个data电影信息对象保存到 页面内部状态变量中

![](_v_images/20200602232228289_7660.png =400x)
但是：<font color=pink>TypeError: this.setData is not a function</font>
因为此时的this指针 指向的是success回调函数所在的参数对象
已经不再指向页面对象，所以就没有setData()方法

##### 如何在回调函数体中访问到外部页面对象呢？
需要在request方法调用之前，先通过onLoad生命周期函数的this指针，将页面对象的引用先做一个保存
然后，再像之前一样访问setData() 方法
![](_v_images/20200602233159797_30549.png =500x)

![](_v_images/20200602233400147_27660.png =500x)
内部状态变量`movie`其中包含了电影的信息
![](_v_images/20200602233418249_7176.png =300x)

最后将其中的关键信息展示到detail页面
